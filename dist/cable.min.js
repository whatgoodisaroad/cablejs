/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-07-05T02:02:06.270Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function c(b,e){for(var h in b)b.hasOwnProperty(h)&&e(b[h],h)}function a(b){if(b.argAliases)return b.argAliases;b=(b+"").match(/^function(\s*)?\(([^)]*)\)/m)[2];return b.length?b.split(",").map(function(b){return b.replace(/(^\s+)|(\s+$)/g,"")}):[]}function g(b,e){return a(b).filter(function(b){return-1==s.indexOf(b)}).map(function(b){return b.replace(/^_/,"")})}function f(b,e){return a(b).filter(function(b){return-1==s.indexOf(b)&&"_"!=b[0]})}function k(b){var e={};return b&&"[object Function]"===
e.toString.call(b)}function l(b){return-1!=a(b).indexOf("result")||-1!=a(b).indexOf("respond")}function m(b){return-1!==a(b).indexOf("define")}function n(b){b=a(b);return 1===b.length&&"event"===b[0]}function w(b,e){if(e){var h={};c(b,function(b,d){h[d]=e.hasOwnProperty(d)?e[d]:b});return h}return b}function A(b){function e(h){if(h.length){var a=h[0],c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b="("+this.responseText+")";delete d[a];var c={};
try{c[a]=eval(b)}catch(f){throw"Failed to load module '"+a+"': "+f;}Cable.define(c,{reify:!1,wireup:!1});e(h.slice(1))}};c.open("get",d[a].url,!0);c.send()}else b()}var h=[],a;for(a in d)d.hasOwnProperty(a)&&"module"===d[a].type&&h.push(a);e(h)}function x(b,e){for(var h="main"===e?"":"_"+e,a=[],d=0;d<b.length;++d)a.push(b.slice(0,b.length-d).join("_")+h);"main"!==e&&a.push(e);return a}function q(b,e){for(var h=x(e.chain,b),a=0;a<h.length;++a)if(d.hasOwnProperty(h[a]))return"alias"===d[h[a]].type?
(h=d[h[a]],q(h.reference,h.scope)):h[a];return null}function y(){c(d,function(b){b.out=[]});c(d,function(b,e){b.fn&&f(b.fn,b.context).forEach(function(h){var a=q(h,b.scope);if(a)d[a].out.push(e);else throw"Reference to undefined node '"+h+"' as dependency of '"+e+"'";})})}function B(){c(d,function(b,e){if("subdefinition"===b.type)if(C(e))t(e,function(a){a.splice(b.defineIndex,0,function(a){var h={};h[e]=a;Cable.define(h,{scope:b.scope})});delete d[e];b.fn.apply(window,a)});else throw"Illegal subdefinition: "+
e+". Subdefs must depend only on libraries";})}function D(){c(d,function(b,e){if("event"===b.type&&!b.isWiredUp){var a=function(b){p(e,function(e){e(b)})};a.setDefault=function(e){b.value=e};b.wireup(a);b.isWiredUp=!0}})}function p(b,e){if(d.hasOwnProperty(b))E[d[b].type](b,e);else throw"Cannot generate: '"+b+"' is not defined";}function r(b,e,a,d){void 0===a&&(a=[]);b.length?d&&d.hasOwnProperty(b[0])?r(b.slice(1),e,a.concat([d[b[0]]]),d):p(b[0],function(c){r(b.slice(1),e,a.concat([c]),d)}):e(a)}
function t(b,e){var a=d[b]["in"].map(function(e){return q(e,d[b].scope)});r(a,e)}function u(b,e){F[d[b].type](b,e)}function v(b){u(b,function(){})}function C(b){return d[b]["in"].map(function(e){return"library"===d[q(e,d[b].scope)].type}).reduce(function(b,a){return b&&a})}var s=["result","respond","type","event","define"],d={};Cable._debug=function(){return d};Cable.each=c;Cable.define=function(b,e){e=w({reify:!0,wireup:!0,scope:{chain:[]}},e);c(b,function(b,a){if(/^_/.test(a))throw"Illegal definition: names cannot begin with an underscore.";
if(-1!=s.indexOf(a))throw"Illegal definition: "+a+" is a reserved word.";if(d.hasOwnProperty(a))throw"Illegal definition: "+a+" is already defined.";var c=null;b.hasOwnProperty("type")?c=b.type:k(b)?l(b)?c="synthetic":m(b)?c="subdefinition":n(b)?(c="event",b={type:"event",wireup:b}):c="effect":c="scope";if(z.hasOwnProperty(c))z[c](a,b,e.scope);else throw"Illegal definiton: could not determine meaning of "+a;});(e.reify||e.wireup)&&A(function(){e.reify&&(y(),B(),y());e.wireup&&D()})};var z={data:function(b,
a,c){d[b]={type:"data",value:a.value,"in":[],out:[],helpers:a.helpers?a.helpers:{},scope:c}},synthetic:function(b,e,c){-1!=a(e).indexOf("respond")?d[b]={type:"synthetic",fn:e,value:null,invoked:!1,"in":g(e,e.context),out:[],resultIndex:a(e).indexOf("respond"),scope:c,coalesce:!1}:d[b]={type:"synthetic",fn:e,value:null,invoked:!1,"in":g(e,e.context),out:[],resultIndex:a(e).indexOf("result"),scope:c,coalesce:!0}},effect:function(b,a,c){d[b]={type:"effect",fn:a,"in":g(a,a.context),out:[],scope:c}},event:function(b,
a,c){d[b]={type:"event",value:a.defaultValue,wireup:a.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:c}},library:function(b,a,c){d[b]={type:"library",path:a.path,shim:a.shim,handle:null,loaded:!1,scope:c}},scope:function(b,a,d){var f={};c(a,function(a,e){f["main"===e?b:b+"_"+e]=a});a=d.chain.map(function(b){return b+"_"}).join("_");d=d.chain.concat([b.slice(a.length)]);Cable.define(f,{reify:!1,wireup:!1,scope:{chain:d}})},subdefinition:function(b,e,c){d[b]={type:"subdefinition",in:g(e),fn:e,
scope:c,defineIndex:a(e).indexOf("define")}},module:function(b,a,c){d[b]={type:"module",url:a.url,scope:c}},alias:function(b,a,c){d[b]={type:"alias",reference:a.reference,scope:c}}},E={data:function(b,a){var f=function(){if(!arguments.length)return d[b].value;arguments[0]!=d[b].value&&(d[b].value=arguments[0],d[b].out.forEach(v))};c(d[b].helpers,function(b,a){f[a]=function(){return b.apply(f,arguments)}});a(f)},synthetic:function(b,a){d[b].invoked?a(function(){return d[b].value}):u(b,function(){})},
effect:function(){},event:function(b,a){a(function(){if(!arguments.length)return d[b].value;arguments[0]==d[b].value&&d[b].coalesce||(d[b].invoked=!0,d[b].value=arguments[0],d[b].out.forEach(v))})},library:function(b,a){d[b].loaded?a(d[b].handle):u(b,function(){p(b,a)})}},F={data:p.data,event:p.event,synthetic:function(b,a){t(b,function(c){c.splice(d[b].resultIndex,0,function(c){d[b].invoked=!0;d[b].value==c&&d[b].coalesce||(d[b].value=c,d[b].out.forEach(v));a()});d[b].fn.apply({},c)})},effect:function(b,
a){t(b,function(c){d[b].fn.apply({},c);a()})},library:function(b,a){if(d[b].loaded)a();else{var c=function(){var c,f,g={},h=0;arguments[h].substring&&h++;c=arguments[h].splice?arguments[h++]:["require","exports","module"];if(k(arguments[h])){var l=arguments[h];f=-1!==c.indexOf("exports")?function(){var b=l.apply(window,arguments);return void 0!==b?b:g}:l}else{var m=arguments[h];f=function(){return m}}r(c,function(c){d[b].handle=f.apply(window,c);d[b].loaded=!0;a()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";
},exports:g,module:null})};c.amd={};var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=this.responseText;d[b].shim&&(a=["define(function() {",a,"\nreturn ",d[b].shim,"; });"].join(""));var e=window.define;window.define=c;try{eval(a)}catch(f){throw"Failed evaluating library "+b+": "+f;}window.define=e;"$"===b&&$&&$.noConflict&&$.noConflict()}};f.open("get",d[b].path,!0);f.send()}}};Cable.initialize=function(b,a){"synthetic"===d[b].type&&(d[b].value=
a,d[b].invoked=!0)};Cable._private&&(Cable._private={getArgNames:a,getFanIn:g,getDependencies:f,isSynthetic:l,isSubDefinition:m,isEvent:n,extend:w,enumerateScopes:x})})();Cable.withArgs=function(c,a){a.argAliases=c;return a};Cable.data=function(c,a){var g={type:"data",value:c};a&&(g.helpers=a);return g};Cable.define({init:Cable.withArgs(["event"],function(c){c(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(c){return{array:Cable.data(c),main:Cable.data({type:"initialize",array:c},{insertAt:function(a,c){this({type:"insert",index:a,element:c})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,c){this({type:"update",index:a,updates:c})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,c){var f=a(),k=c().slice(0);if("insert"===f.type)k.splice(0<=
f.index?f.index:k.length,0,f.element);else if("update"===f.type)for(var l in f.updates)f.updates.hasOwnProperty(l)&&(k[f.index][l]=f.updates[l]);else"delete"===f.type&&k.splice(f.index,1);c(k)})}};
Cable.interval=function(c,a){if(c.substring){var g=[c,"_pid"];a&&(g=g.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(g,function(a,c,g){clearInterval(c());a=setInterval(function(){g(new Date)},a());c(a)})}}return{type:"event",defaultValue:new Date,wireup:function(f){setInterval(function(){f(new Date)},c);a&&f(new Date)}}};Cable.library=function(c,a){return{type:"library",path:c,shim:a}};Cable.module=function(c){return{type:"module",url:c}};
Cable.pack=function(c){var a=function(c){for(var f={},k=1;k<a.argAliases.length;++k)f[a.argAliases[k]]=arguments[k]();c(f)};c=c.slice(0);c.splice(0,0,"result");return Cable.withArgs(c,a)};Cable.counter=function(){return Cable.data(-1,{next:function(){var c=this()+1;this(c);return c}})};Cable.alias=function(c){return{type:"alias",reference:c}};Cable.repeat=function(c,a){return{interval:Cable.interval(c),index:Cable.data(-1),increment:function(c,f){f((f()+1)%a.length)},main:function(c,f){f(a[c()])}}};Cable.textbox=function(c){return Cable.withArgs(["$","define"],function(a,g){g(Cable.withArgs(["event"],function(f){var g=a(c),l=function(){return g.is("[type='number']")?parseFloat(g.val()):g.val()};g.on("change keyup",function(){f(l())});f(l())}))})};Cable.checkbox=function(c){return Cable.withArgs(["$","define"],function(a,g){var f=a(c);g(Cable.withArgs(["event"],function(a){f.on("change",function(){a(f.is(":checked"))});a(f.is(":checked"))}))})};
Cable.button=function(c){return Cable.withArgs(["$","define"],function(a,g){g(Cable.withArgs(["event"],function(f){a(c).on("click",function(){f(new Date)})}))})};Cable.returnKey=function(c){return Cable.withArgs(["$","define"],function(a,g){g({type:"event",wireup:function(f){a(c).on("keyup",function(a){13===a.keyCode&&f(new Date)})}})})};
Cable.template=function(c,a){var g=(a.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(g),main:Cable.withArgs(["properties","$"],function(f,k){function l(a){return"number"===typeof a?a.toFixed(2):a}for(var m=a,n=0;n<g.length;++n)m=m.replace("{{"+g[n]+"}}",l(f()[g[n]]));k(c).html(m)})}};
Cable.json=function(c){return{url:c,main:Cable.withArgs(["$","url","result"],function(a,c,f){var k=/^http/.test(c())&&!/callback=/.test(c());a.ajax({dataType:"json",url:c(),crossDomain:!!k,success:function(a){f(a)}})})}};Cable.text=function(c){return Cable.withArgs(["$","result"],function(a,g){a.ajax({url:c,dataType:"text",success:function(a){g(a)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(c,a){var g={};c("[cable]").each(function(a,k){c(k).is(":text")?g[k.id]=Cable.textbox("#"+k.id):g[k.id]=Cable.template("#"+k.id,k.innerText)});a(g)})};
Cable.chain=function(c){for(var a=[],g="take drop map filter reduce reduceRight contains max min sortBy groupBy size flatten uniq".split(" "),f=function(c,f){for(var g=f.chain(c()),k=0;k<a.length;++k)g=g[a[k].type].apply(g,a[k].args);return g.value()},k={value:function(){return Cable.withArgs([c,"underscore","result"],function(a,c,g){g(f(a,c))})},each:function(){return Cable.withArgs([c,"underscore","result"],function(a,c,g){f(a,c).forEach(g)})}},l=0;l<g.length;++l)(function(c){k[g[c]]=function(){a.push({type:g[c],
args:arguments});return k}})(l);return k};
