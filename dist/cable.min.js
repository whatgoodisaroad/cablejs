/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-07-05T04:19:59.973Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function b(c,h){for(var l in c)c.hasOwnProperty(l)&&h(c[l],l)}function a(c){if(c.argAliases)return c.argAliases;c=(c+"").match(/^function(\s*)?\(([^)]*)\)/m)[2];return c.length?c.split(",").map(function(c){return c.replace(/(^\s+)|(\s+$)/g,"")}):[]}function f(c,h){return a(c).filter(function(c){return-1==x.indexOf(c)}).map(function(c){return c.replace(/^_/,"")})}function d(c,h){return a(c).filter(function(c){return-1==x.indexOf(c)&&"_"!=c[0]})}function g(c){var h={};return c&&"[object Function]"===
h.toString.call(c)}function k(c){return-1!=a(c).indexOf("result")||-1!=a(c).indexOf("respond")}function s(c){return-1!==a(c).indexOf("define")}function n(c){c=a(c);return 1===c.length&&"event"===c[0]}function m(c,h){if(h){var l={};b(c,function(c,a){l[a]=h.hasOwnProperty(a)?h[a]:c});return l}return c}function q(c){function h(l){if(l.length){var a=l[0],b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var c="("+this.responseText+")";delete e[a];var b={};
try{b[a]=eval(c)}catch(d){throw"Failed to load module '"+a+"': "+d;}Cable.define(b,{reify:!1,wireup:!1});h(l.slice(1))}};b.open("get",e[a].url,!0);b.send()}else c()}var l=[],a;for(a in e)e.hasOwnProperty(a)&&"module"===e[a].type&&l.push(a);h(l)}function t(c,h){for(var a="main"===h?"":"_"+h,b=[],e=0;e<c.length;++e)b.push(c.slice(0,c.length-e).join("_")+a);"main"!==h&&b.push(h);return b}function r(c,h){for(var a=t(h.chain,c),b=0;b<a.length;++b)if(e.hasOwnProperty(a[b]))return"alias"===e[a[b]].type?
(a=e[a[b]],r(a.reference,a.scope)):a[b];return null}function u(){b(e,function(c){c.out=[]});b(e,function(c,h){c.fn&&d(c.fn,c.context).forEach(function(a){var b=r(a,c.scope);if(b)e[b].out.push(h);else throw"Reference to undefined node '"+a+"' as dependency of '"+h+"'";})})}function p(){b(e,function(c,h){if("subdefinition"===c.type)if(C(h))y(h,function(a){a.splice(c.defineIndex,0,function(a){var b={};b[h]=a;Cable.define(b,{scope:c.scope})});delete e[h];c.fn.apply(window,a)});else throw"Illegal subdefinition: "+
h+". Subdefs must depend only on libraries";})}function D(){b(e,function(c,a){if("event"===c.type&&!c.isWiredUp){var b=function(c){v(a,function(a){a(c)})};b.setDefault=function(a){c.value=a};c.wireup(b);c.isWiredUp=!0}})}function v(c,a){if(e.hasOwnProperty(c))E[e[c].type](c,a);else throw"Cannot generate: '"+c+"' is not defined";}function w(c,a,b,e){void 0===b&&(b=[]);c.length?e&&e.hasOwnProperty(c[0])?w(c.slice(1),a,b.concat([e[c[0]]]),e):v(c[0],function(d){w(c.slice(1),a,b.concat([d]),e)}):a(b)}
function y(c,a){var b=e[c]["in"].map(function(a){return r(a,e[c].scope)});w(b,a)}function z(c,a){F[e[c].type](c,a)}function A(c){z(c,function(){})}function C(c){return e[c]["in"].map(function(a){return"library"===e[r(a,e[c].scope)].type}).reduce(function(c,a){return c&&a})}var x=["result","respond","type","event","define"],e={};Cable._debug=function(){return e};Cable.each=b;Cable.define=function(c,a){a=m({reify:!0,wireup:!0,scope:{chain:[]}},a);b(c,function(c,b){if(/^_/.test(b))throw"Illegal definition: names cannot begin with an underscore.";
if(-1!=x.indexOf(b))throw"Illegal definition: "+b+" is a reserved word.";if(e.hasOwnProperty(b))throw"Illegal definition: "+b+" is already defined.";var d=null;c.hasOwnProperty("type")?d=c.type:g(c)?k(c)?d="synthetic":s(c)?d="subdefinition":n(c)?(d="event",c={type:"event",wireup:c}):d="effect":d="scope";if(B.hasOwnProperty(d))B[d](b,c,a.scope);else throw"Illegal definiton: could not determine meaning of "+b;});(a.reify||a.wireup)&&q(function(){a.reify&&(u(),p(),u());a.wireup&&D()})};var B={data:function(c,
a,b){e[c]={type:"data",value:a.value,"in":[],out:[],helpers:a.helpers?a.helpers:{},scope:b}},synthetic:function(c,b,d){-1!=a(b).indexOf("respond")?e[c]={type:"synthetic",fn:b,value:null,invoked:!1,"in":f(b,b.context),out:[],resultIndex:a(b).indexOf("respond"),scope:d,coalesce:!1}:e[c]={type:"synthetic",fn:b,value:null,invoked:!1,"in":f(b,b.context),out:[],resultIndex:a(b).indexOf("result"),scope:d,coalesce:!0}},effect:function(c,a,b){e[c]={type:"effect",fn:a,"in":f(a,a.context),out:[],scope:b}},event:function(c,
a,b){e[c]={type:"event",value:a.defaultValue,wireup:a.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:b}},library:function(c,a,b){e[c]={type:"library",path:a.path,shim:a.shim,handle:null,loaded:!1,scope:b}},scope:function(c,a,d){var e={};b(a,function(a,b){e["main"===b?c:c+"_"+b]=a});a=d.chain.map(function(c){return c+"_"}).join("_");d=d.chain.concat([c.slice(a.length)]);Cable.define(e,{reify:!1,wireup:!1,scope:{chain:d}})},subdefinition:function(c,b,d){e[c]={type:"subdefinition",in:f(b),fn:b,
scope:d,defineIndex:a(b).indexOf("define")}},module:function(c,a,b){e[c]={type:"module",url:a.url,scope:b}},alias:function(c,a,b){e[c]={type:"alias",reference:a.reference,scope:b}}},E={data:function(c,a){var d=function(){if(!arguments.length)return e[c].value;arguments[0]!=e[c].value&&(e[c].value=arguments[0],e[c].out.forEach(A))};b(e[c].helpers,function(c,a){d[a]=function(){return c.apply(d,arguments)}});a(d)},synthetic:function(c,a){e[c].invoked?a(function(){return e[c].value}):z(c,function(){})},
effect:function(){},event:function(c,a){a(function(){if(!arguments.length)return e[c].value;arguments[0]==e[c].value&&e[c].coalesce||(e[c].invoked=!0,e[c].value=arguments[0],e[c].out.forEach(A))})},library:function(c,a){e[c].loaded?a(e[c].handle):z(c,function(){v(c,a)})}},F={data:v.data,event:v.event,synthetic:function(c,a){y(c,function(b){b.splice(e[c].resultIndex,0,function(b){e[c].invoked=!0;e[c].value==b&&e[c].coalesce||(e[c].value=b,e[c].out.forEach(A));a()});e[c].fn.apply({},b)})},effect:function(c,
a){y(c,function(b){e[c].fn.apply({},b);a()})},library:function(c,a){if(e[c].loaded)a();else{var b=function(){var b,d,f={},m=0;arguments[m].substring&&m++;b=arguments[m].splice?arguments[m++]:["require","exports","module"];if(g(arguments[m])){var k=arguments[m];d=-1!==b.indexOf("exports")?function(){var c=k.apply(window,arguments);return void 0!==c?c:f}:k}else{var n=arguments[m];d=function(){return n}}w(b,function(b){e[c].handle=d.apply(window,b);e[c].loaded=!0;a()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";
},exports:f,module:null})};b.amd={};var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=this.responseText;e[c].shim&&(a=["define(function() {",a,"\nreturn ",e[c].shim,"; });"].join(""));var d=window.define;window.define=b;try{eval(a)}catch(f){throw"Failed evaluating library "+c+": "+f;}window.define=d;"$"===c&&$&&$.noConflict&&$.noConflict()}};d.open("get",e[c].path,!0);d.send()}}};Cable.initialize=function(a,b){"synthetic"===e[a].type&&(e[a].value=
b,e[a].invoked=!0)};Cable._private&&(Cable._private={getArgNames:a,getFanIn:f,getDependencies:d,isSynthetic:k,isSubDefinition:s,isEvent:n,extend:m,enumerateScopes:t})})();Cable.withArgs=function(b,a){a.argAliases=b;return a};Cable.data=function(b,a){var f={type:"data",value:b};a&&(f.helpers=a);return f};Cable.define({init:Cable.withArgs(["event"],function(b){b(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(b){return{array:Cable.data(b),main:Cable.data({type:"initialize",array:b},{insertAt:function(a,b){this({type:"insert",index:a,element:b})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,b){this({type:"update",index:a,updates:b})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,b){var d=a(),g=b().slice(0);if("insert"===d.type)g.splice(0<=
d.index?d.index:g.length,0,d.element);else if("update"===d.type)for(var k in d.updates)d.updates.hasOwnProperty(k)&&(g[d.index][k]=d.updates[k]);else"delete"===d.type&&g.splice(d.index,1);b(g)})}};
Cable.interval=function(b,a){if(b.substring){var f=[b,"_pid"];a&&(f=f.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(f,function(a,b,f){clearInterval(b());a=setInterval(function(){f(new Date)},a());b(a)})}}return{type:"event",defaultValue:new Date,wireup:function(d){setInterval(function(){d(new Date)},b);a&&d(new Date)}}};Cable.library=function(b,a){return{type:"library",path:b,shim:a}};Cable.module=function(b){return{type:"module",url:b}};
Cable.pack=function(b){var a=function(b){for(var d={},g=1;g<a.argAliases.length;++g)d[a.argAliases[g]]=arguments[g]();b(d)};b=b.slice(0);b.splice(0,0,"result");return Cable.withArgs(b,a)};Cable.counter=function(){return Cable.data(-1,{next:function(){var b=this()+1;this(b);return b}})};Cable.alias=function(b){return{type:"alias",reference:b}};Cable.repeat=function(b,a){return{interval:Cable.interval(b),index:Cable.data(-1),increment:function(b,d){d((d()+1)%a.length)},main:function(b,d){d(a[b()])}}};Cable.textbox=function(b){return Cable.withArgs(["$","define"],function(a,f){f(Cable.withArgs(["event"],function(d){var f=a(b),k=function(){return f.is("[type='number']")?parseFloat(f.val()):f.val()};f.on("change keyup",function(){d(k())});d(k())}))})};Cable.checkbox=function(b){return Cable.withArgs(["$","define"],function(a,f){var d=a(b);f(Cable.withArgs(["event"],function(a){d.on("change",function(){a(d.is(":checked"))});a(d.is(":checked"))}))})};
Cable.button=function(b){return Cable.withArgs(["$","define"],function(a,f){f(Cable.withArgs(["event"],function(d){a(b).on("click",function(){d(new Date)})}))})};Cable.returnKey=function(b){return Cable.withArgs(["$","define"],function(a,f){f({type:"event",wireup:function(d){a(b).on("keyup",function(a){13===a.keyCode&&d(new Date)})}})})};
Cable.template=function(b,a){var f=(a.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(f),main:Cable.withArgs(["properties","$"],function(d,g){function k(a){return"number"===typeof a?a.toFixed(2):a}for(var s=a,n=0;n<f.length;++n)s=s.replace("{{"+f[n]+"}}",k(d()[f[n]]));g(b).html(s)})}};
Cable.json=function(b){return{url:b,main:Cable.withArgs(["$","url","result"],function(a,b,d){var g=/^http/.test(b())&&!/callback=/.test(b());a.ajax({dataType:"json",url:b(),crossDomain:!!g,success:function(a){d(a)}})})}};Cable.text=function(b){return Cable.withArgs(["$","result"],function(a,f){a.ajax({url:b,dataType:"text",success:function(a){f(a)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(b,a){var f={};b("[cable]").each(function(a,g){b(g).is(":text")?f[g.id]=Cable.textbox("#"+g.id):f[g.id]=Cable.template("#"+g.id,g.innerText)});a(f)})};
Cable.chain=function(b){for(var a=[],f="take drop map filter reduce reduceRight contains max min sortBy groupBy size flatten uniq".split(" "),d=function(b,d){for(var f=d.chain(b()),g=0;g<a.length;++g)f=f[a[g].type].apply(f,a[g].args);return f.value()},g={value:function(){return Cable.withArgs([b,"underscore","result"],function(a,b,f){f(d(a,b))})},each:function(){return Cable.withArgs([b,"underscore","result"],function(a,b,f){d(a,b).forEach(f)})}},k=0;k<f.length;++k)(function(b){g[f[b]]=function(){a.push({type:f[b],
args:arguments});return g}})(k);return g};Cable.hash=function(){return Cable.withArgs(["$","define"],function(b,a){a(Cable.withArgs(["event"],function(a){a(location.hash.replace(/^#/,""));b(window).on("hashchange",function(b){a(location.hash.replace(/^#/,""))})}))})};
Cable.router=function(b){b.substring&&(b=[b]);for(var a=[],f=0;f<b.length;++f)for(var d=b[f].split("/"),g=0;g<d.length;++g)/^:/.test(d[g])&&-1==a.indexOf(d[g].substring(1))&&a.push(d[g].substring(1));f={routeIndex:Cable.data(null),hash:Cable.hash(),main:Cable.data(null),route:Cable.withArgs(["hash","_main","_routeIndex"],function(a,d,f){for(var g=0;g<b.length;++g){var q=b[g].split("/"),t=a().split("/"),r={},u=!1;if(q.length!=t.length)break;for(var p=0;p<q.length;++p)if(/^:/.test(q[p]))r[q[p].substring(1)]=
t[p];else if(q[p]!=t[p]){u=!0;break}if(!u){d(r);f(g);return}}d(!1);f(-1)}),updateTerms:Cable.withArgs(["main"].concat(a.map(function(a){return"_terms_"+a})),function(b){var d=a.slice(0),f=b(),g;for(g in f)f.hasOwnProperty(g)&&(arguments[a.indexOf(g)+1](f[g]),d[a.indexOf(g)]=!1);for(f=0;f<d.length;++f)if(d[f])arguments[f+1](null)}),terms:{}};for(d=0;d<a.length;++d)f.terms[a[d]]=Cable.data(null);return f};
