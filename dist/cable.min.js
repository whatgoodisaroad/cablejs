/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-03-26T20:01:38.366Z              .
.......................................*/
'use strict';var Cable={};
(function(){function a(b,e){for(var h in b)b.hasOwnProperty(h)&&e(b[h],h)}function c(b){return b.argAliases?b.argAliases:(b+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(b){return b.replace(/(^\s+)|(\s+$)/g,"")})}function d(b,e){return c(b).filter(function(b){return-1==r.indexOf(b)}).map(function(b){return b.replace(/^_/,"")})}function g(b,e){return c(b).filter(function(b){return-1==r.indexOf(b)&&"_"!=b[0]})}function k(b){var e={};return b&&"[object Function]"===e.toString.call(b)}
function l(b,e){if(e){var h={};a(b,function(b,f){h[f]=e.hasOwnProperty(f)?e[f]:b});return h}return b}function n(b){function e(h){if(h.length){var c=h[0],a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b="("+this.responseText+")";delete f[c];var a={};try{a[c]=eval(b)}catch(d){throw"Failed to load module '"+c+"': "+d;}Cable.define(a,{reify:!1,wireup:!1});e(h.slice(1))}};a.open("get",f[c].url,!0);a.send()}else b()}var h=[],c;for(c in f)f.hasOwnProperty(c)&&
"module"===f[c].type&&h.push(c);e(h)}function m(b,e){for(var h=e.chain,c="main"===b?"":"_"+b,a=[],d=0;d<h.length;++d)a.push(h.slice(0,h.length-d).join("_")+c);a.push(b);for(h=0;h<a.length;++h)if(f.hasOwnProperty(a[h]))return a[h];return null}function w(){a(f,function(b){b.out=[]});a(f,function(b,e){b.fn&&g(b.fn,b.context).forEach(function(h){var c=m(h,b.scope);if(c)f[c].out.push(e);else throw"Reference to undefined node '"+h+"' as dependency of '"+e+"'";})})}function x(){a(f,function(b,e){"event"!==
b.type||b.isWiredUp||(b.wireup(function(b){p(e,function(e){e(b)})}),b.isWiredUp=!0)})}function p(b,e){if(f.hasOwnProperty(b))y[f[b].type](b,e);else throw"Cannot generate: '"+b+"' is not defined";}function q(b,e,c,a){void 0===c&&(c=[]);b.length?a&&a.hasOwnProperty(b[0])?q(b.slice(1),e,c.concat([a[b[0]]]),a):p(b[0],function(f){q(b.slice(1),e,c.concat([f]),a)}):e(c)}function u(b,e){var c=f[b]["in"].map(function(e){return m(e,f[b].scope)});q(c,e)}function s(b,e){z[f[b].type](b,e)}function t(b){s(b,function(){})}
var r=["result","respond","define","type","event"],f={};Cable._debug=function(){return f};Cable.each=a;Cable.define=function(b,e){e=l({reify:!0,wireup:!0,scope:{chain:[]}},e);a(b,function(b,a){if(/^_/.test(a))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=r.indexOf(a))throw"Illegal definition: "+a+" is a reserved word.";if(f.hasOwnProperty(a))throw"Illegal definition: "+a+" is already defined.";var d=null,d=b.hasOwnProperty("type")?b.type:k(b)?-1!=c(b).indexOf("result")||
-1!=c(b).indexOf("respond")?"synthetic":"effect":"sub";if(v.hasOwnProperty(d))v[d](a,b,e.scope);else if("sub"!==d)throw"Illegal definiton: could not determine meaning of "+a;});(e.reify||e.wireup)&&n(function(){e.reify&&w();e.wireup&&x()})};var v={data:function(b,e,a){f[b]={type:"data",value:e.value,"in":[],out:[],helpers:e.helpers?e.helpers:{},scope:a}},synthetic:function(b,e,a){-1!=c(e).indexOf("respond")?f[b]={type:"synthetic",fn:e,value:null,invoked:!1,"in":d(e,e.context),out:[],resultIndex:c(e).indexOf("respond"),
scope:a,coalesce:!1}:f[b]={type:"synthetic",fn:e,value:null,invoked:!1,"in":d(e,e.context),out:[],resultIndex:c(e).indexOf("result"),scope:a,coalesce:!0}},effect:function(b,e,a){f[b]={type:"effect",fn:e,"in":d(e,e.context),out:[],scope:a}},event:function(b,e,a){f[b]={type:"event",value:e.defaultValue,wireup:e.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:a}},library:function(b,a,c){f[b]={type:"library",path:a.path,shim:a.shim,handle:null,loaded:!1,scope:c}},sub:function(b,e,c){var f={};a(e,
function(a,e){f["main"===e?b:b+"_"+e]=a});Cable.define(f,{reify:!1,wireup:!1,scope:{chain:c.chain.concat([b])}})},module:function(b,a,c){f[b]={type:"module",url:a.url,scope:c}}},y={data:function(b,e){var c=function(){if(!arguments.length)return f[b].value;arguments[0]!=f[b].value&&(f[b].value=arguments[0],f[b].out.forEach(t))};a(f[b].helpers,function(b,a){c[a]=function(){return b.apply(c,arguments)}});e(c)},synthetic:function(b,a){f[b].invoked?a(function(){return f[b].value}):s(b,function(){})},effect:function(){},
event:function(b,a){a(function(){if(!arguments.length)return f[b].value;arguments[0]==f[b].value&&f[b].coalesce||(f[b].invoked=!0,f[b].value=arguments[0],f[b].out.forEach(t))})},library:function(b,a){f[b].loaded?a(f[b].handle):s(b,function(){p(b,a)})}};Cable.generate=p;var z={data:p.data,event:p.event,synthetic:function(b,a){u(b,function(c){c.splice(f[b].resultIndex,0,function(c){f[b].invoked=!0;f[b].value==c&&f[b].coalesce||(f[b].value=c,f[b].out.forEach(t));a()});f[b].fn.apply({},c)})},effect:function(b,
a){u(b,function(c){f[b].fn.apply({},c);a()})},library:function(b,a){if(f[b].loaded)a();else{var c=function(){var a,c,e={},d=0;arguments[d].substring&&d++;a=arguments[d].splice?arguments[d++]:["require","exports","module"];if(k(arguments[d])){var g=arguments[d];c=-1!==a.indexOf("exports")?function(){var b=g.apply(window,arguments);return void 0!==b?b:e}:g}else{var h=arguments[d];c=function(){return h}}q(a,function(a){f[b].handle=c.apply(window,a);f[b].loaded=!0},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";
},exports:e,module:null})};c.amd={};var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var d=this.responseText;f[b].shim&&(d=["define(function() {",d,"\nreturn ",f[b].shim,"; });"].join(""));window.define=c;eval(d);delete window.define;"$"===b&&$&&$.noConflict&&$.noConflict();a()}};d.open("get",f[b].path,!0);d.send()}}};Cable.initialize=function(b,a){"synthetic"===f[b].type&&(f[b].value=a,f[b].invoked=!0)}})();Cable.withArgs=function(a,c){c.argAliases=a;return c};Cable.data=function(a,c){var d={type:"data",value:a};c&&(d.helpers=c);return d};Cable.define({init:{type:"event",wireup:function(a){a(new Date)}}},{reify:!1,wireup:!1});
Cable.list=function(a){return{array:Cable.data(a),main:Cable.data({type:"initialize",array:a},{insertAt:function(a,d){this({type:"insert",index:a,element:d})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,d){this({type:"update",index:a,updates:d})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,d){var g=a(),k=d().slice(0);if("insert"===g.type)k.splice(0<=
g.index?g.index:k.length,0,g.element);else if("update"===g.type)for(var l in g.updates)g.updates.hasOwnProperty(l)&&(k[g.index][l]=g.updates[l]);else"delete"===g.type&&k.splice(g.index,1);d(k)})}};
Cable.interval=function(a,c){if(a.substring){var d=[a,"_pid"];c&&(d=d.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(d,function(a,c,d){clearInterval(c());a=setInterval(function(){d(new Date)},a());c(a)})}}return{type:"event",defaultValue:new Date,wireup:function(d){setInterval(function(){d(new Date)},a);c&&d(new Date)}}};Cable.library=function(a,c){return{type:"library",path:a,shim:c}};Cable.module=function(a){return{type:"module",url:a}};
Cable.pack=function(a){var c=function(a){for(var g={},k=1;k<c.argAliases.length;++k)g[c.argAliases[k]]=arguments[k]();a(g)};a=a.slice(0);a.splice(0,0,"result");c.argAliases=a;return c};Cable.counter=function(){return Cable.data(-1,{next:function(){var a=this()+1;this(a);return a}})};Cable.event=function(a,c,d,g){return{type:"event",coalesce:!1,wireup:function(k){Cable.generate("$",function(l){if("document"===a&&"ready"===c)l(document).ready(k);else{var n=function(){var c=null,g=l(a);d||(d="time");"value"===d?(c=g.val(),g.is("[type='number']")&&(c=parseFloat(c))):"time"===d?c=new Date:/^data-[-_a-zA-Z0-9]+/.test(d)?c=g.attr(d):":checked"===d&&(c=g.is(":checked"));k(c)},m;"key-return"===c?(c="keyup",m=function(a){13===a.keyCode&&n()}):m=n;l(document).on(c,a,m);g&&n()}})}}};
Cable.textbox=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(d){var g=d(a),k=function(){return g.is("[type='number']")?parseFloat(g.val()):g.val()};g.on("change keyup",function(){c(k())});c(k())})}}};Cable.checkbox=function(a){return Cable.event(a,"change",":checked",!0)};Cable.button=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(d){d(a).on("click",function(){c(new Date)})})}}};
Cable.returnKey=function(a){return{type:"event",wireup:function(c){Cable.generate("$",function(d){d(a).on("keyup",function(a){13===a.keyCode&&c(new Date)})})}}};Cable.template=function(a,c){var d=(c.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(d),main:Cable.withArgs(["properties","$"],function(g,k){function l(a){return"number"===typeof a?a.toFixed(2):a}for(var n=c,m=0;m<d.length;++m)n=n.replace("{{"+d[m]+"}}",l(g()[d[m]]));k(a).html(n)})}};
Cable.json=function(a){return{url:a,main:Cable.withArgs(["$","url","result"],function(a,d,g){var k=/^http/.test(d())&&!/callback=/.test(d());a.ajax({dataType:"json",url:d(),crossDomain:!!k,success:function(a){g(a)}})})}};Cable.text=function(a){return Cable.withArgs(["$","result"],function(c,d){c.ajax({url:a,dataType:"text",success:function(a){d(a)}})})};
