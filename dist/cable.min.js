/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-10-31T04:43:18.907Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function b(c,h){for(var l in c)c.hasOwnProperty(l)&&h(c[l],l)}function a(c){if(c.argAliases)return c.argAliases;c=(c+"").match(/^function(\s*)?\(([^)]*)\)/m)[2];return c.length?c.split(",").map(function(c){return c.replace(/(^\s+)|(\s+$)/g,"")}):[]}function e(c,h){return a(c).filter(function(c){return-1==x.indexOf(c)}).map(function(c){return c.replace(/^_/,"")})}function d(c,h){return a(c).filter(function(c){return-1==x.indexOf(c)&&"_"!=c[0]})}function g(c){var h={};return c&&"[object Function]"===
h.toString.call(c)}function k(c){return-1!=a(c).indexOf("result")||-1!=a(c).indexOf("respond")}function r(c){return-1!==a(c).indexOf("define")}function m(c){c=a(c);return 1===c.length&&"event"===c[0]}function v(c,h){if(h){var l={};b(c,function(c,a){l[a]=h.hasOwnProperty(a)?h[a]:c});return l}return c}function p(c){function h(a){if(a.length){var l=a[0],b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var c="("+this.responseText+")";delete f[l];var b={};
try{b[l]=eval(c)}catch(d){throw"Failed to load module '"+l+"': "+d;}Cable.define(b,{reify:!1,wireup:!1});h(a.slice(1))}};b.open("get",f[l].url,!0);b.send()}else c()}var l=[],a;for(a in f)f.hasOwnProperty(a)&&"module"===f[a].type&&l.push(a);h(l)}function s(c,h){for(var a="main"===h?"":"_"+h,b=[],d=0;d<c.length;++d)b.push(c.slice(0,c.length-d).join("_")+a);"main"!==h&&b.push(h);return b}function q(c,h){for(var a=s(h.chain,c),b=0;b<a.length;++b)if(f.hasOwnProperty(a[b]))return"alias"===f[a[b]].type?
(a=f[a[b]],q(a.reference,a.scope)):a[b];return null}function t(){b(f,function(c){c.out=[]});b(f,function(c,h){c.fn&&d(c.fn,c.context).forEach(function(a){var b=q(a,c.scope);if(b)f[b].out.push(h);else throw"Reference to undefined node '"+a+"' as dependency of '"+h+"'";})})}function n(){b(f,function(c,h){if("subdefinition"===c.type&&!c.isExecuting)if(c.isExecuting=!0,C(h))y(h,function(a){a.splice(c.defineIndex,0,function(a){var b={};b[h]=a;Cable.define(b,{scope:c.scope})});delete f[h];c.fn.apply(window,
a)});else throw"Illegal subdefinition: "+h+". Subdefs must depend only on libraries";})}function D(){b(f,function(c,a){if("event"===c.type&&!c.isWiredUp){var b=function(c){u(a,function(a){a(c)})};b.setDefault=function(a){c.value=a};c.wireup(b);c.isWiredUp=!0}})}function u(c,a){if(f.hasOwnProperty(c))E[f[c].type](c,a);else throw"Cannot generate: '"+c+"' is not defined";}function w(c,a,b,d){void 0===b&&(b=[]);c.length?d&&d.hasOwnProperty(c[0])?w(c.slice(1),a,b.concat([d[c[0]]]),d):u(c[0],function(e){w(c.slice(1),
a,b.concat([e]),d)}):a(b)}function y(c,a){var b=f[c]["in"].map(function(a){return q(a,f[c].scope)});w(b,a)}function z(c,a){F[f[c].type](c,a)}function A(c){z(c,function(){})}function C(c){return f[c]["in"].map(function(a){return"library"===f[q(a,f[c].scope)].type}).reduce(function(c,a){return c&&a})}var x=["result","respond","type","event","define"],f={};Cable._debug=function(){return f};Cable.each=b;Cable.define=function(c,a){a=v({reify:!0,wireup:!0,scope:{chain:[]}},a);b(c,function(c,b){if(/^_/.test(b))throw"Illegal definition: names cannot begin with an underscore.";
if(-1!=x.indexOf(b))throw"Illegal definition: "+b+" is a reserved word.";if(f.hasOwnProperty(b))throw"Illegal definition: "+b+" is already defined.";var d=null;c.hasOwnProperty("type")?d=c.type:g(c)?k(c)?d="synthetic":r(c)?d="subdefinition":m(c)?(d="event",c={type:"event",wireup:c}):d="effect":d="scope";if(B.hasOwnProperty(d))B[d](b,c,a.scope);else throw"Illegal definiton: could not determine meaning of "+b;});(a.reify||a.wireup)&&p(function(){a.reify&&(t(),n(),t());a.wireup&&D()})};var B={data:function(c,
a,b){f[c]={type:"data",value:a.value,"in":[],out:[],helpers:a.helpers?a.helpers:{},scope:b}},synthetic:function(c,b,d){-1!=a(b).indexOf("respond")?f[c]={type:"synthetic",fn:b,value:null,invoked:!1,"in":e(b,b.context),out:[],resultIndex:a(b).indexOf("respond"),scope:d,coalesce:!1}:f[c]={type:"synthetic",fn:b,value:null,invoked:!1,"in":e(b,b.context),out:[],resultIndex:a(b).indexOf("result"),scope:d,coalesce:!0}},effect:function(c,a,b){f[c]={type:"effect",fn:a,"in":e(a,a.context),out:[],scope:b}},event:function(c,
a,b){f[c]={type:"event",value:a.defaultValue,wireup:a.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:b}},library:function(c,a,b){f[c]={type:"library",path:a.path,shim:a.shim,handle:null,loaded:!1,scope:b}},scope:function(c,a,d){var e={};b(a,function(a,b){e["main"===b?c:c+"_"+b]=a});a=d.chain.length?a=d.chain.map(function(c){return c}).join("_")+"_":"";d=d.chain.concat([c.slice(a.length)]);Cable.define(e,{reify:!1,wireup:!1,scope:{chain:d}})},subdefinition:function(c,b,d){f[c]={type:"subdefinition",
in:e(b),fn:b,scope:d,defineIndex:a(b).indexOf("define"),isExecuting:!1}},module:function(c,a,b){f[c]={type:"module",url:a.url,scope:b}},alias:function(c,a,b){f[c]={type:"alias",reference:a.reference,scope:b}}},E={data:function(c,a){var d=function(){if(!arguments.length)return f[c].value;if(arguments[0]!=f[c].value||"object"===typeof arguments[0])f[c].value=arguments[0],f[c].out.forEach(A)};b(f[c].helpers,function(c,a){d[a]=function(){return c.apply(d,arguments)}});a(d)},synthetic:function(c,a){f[c].invoked?
a(function(){return f[c].value}):z(c,function(){})},effect:function(){},event:function(c,a){a(function(){if(!arguments.length)return f[c].value;arguments[0]==f[c].value&&f[c].coalesce||(f[c].invoked=!0,f[c].value=arguments[0],f[c].out.forEach(A))})},library:function(c,a){f[c].loaded?a(f[c].handle):z(c,function(){u(c,a)})}},F={data:u.data,event:u.event,synthetic:function(c,a){y(c,function(b){b.splice(f[c].resultIndex,0,function(b){f[c].invoked=!0;f[c].value==b&&f[c].coalesce||(f[c].value=b,f[c].out.forEach(A));
a()});f[c].fn.apply({},b)})},effect:function(c,a){y(c,function(b){f[c].fn.apply({},b);a()})},library:function(c,a){if(f[c].loaded)a();else{var b=function(){var b,d,e={},k=0;arguments[k].substring&&k++;b=arguments[k].splice?arguments[k++]:["require","exports","module"];if(g(arguments[k])){var m=arguments[k];d=-1!==b.indexOf("exports")?function(){var a=m.apply(window,arguments);return void 0!==a?a:e}:m}else{var v=arguments[k];d=function(){return v}}w(b,function(b){f[c].handle=d.apply(window,b);f[c].loaded=
!0;a()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";},exports:e,module:null})};b.amd={};var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=this.responseText;f[c].shim&&(a=["define(function() {",a,"\nreturn ",f[c].shim,"; });"].join(""));var d=window.define;window.define=b;try{eval(a)}catch(e){throw"Failed evaluating library "+c+": "+e;}window.define=d;"$"===c&&$&&$.noConflict&&$.noConflict()}};d.open("get",
f[c].path,!0);d.send()}}};Cable.initialize=function(a,b){"synthetic"===f[a].type&&(f[a].value=b,f[a].invoked=!0)};Cable._private&&(Cable._private={getArgNames:a,getFanIn:e,getDependencies:d,isSynthetic:k,isSubDefinition:r,isEvent:m,extend:v,enumerateScopes:s})})();Cable.withArgs=function(b,a){a.argAliases=b;return a};Cable.data=function(b,a){var e={type:"data",value:b};a&&(e.helpers=a);return e};Cable.define({init:Cable.withArgs(["event"],function(b){b(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(b){return{array:Cable.data(b),main:Cable.data({type:"initialize",array:b},{insertAt:function(a,b){this({type:"insert",index:a,element:b})},prepend:function(a){this({type:"insert",index:0,element:a})},append:function(a){this({type:"insert",index:-1,element:a})},updateAt:function(a,b){this({type:"update",index:a,updates:b})},deleteAt:function(a){this({type:"delete",index:a})}}),updater:Cable.withArgs(["main","_array"],function(a,b){var d=a(),g=b().slice(0);if("insert"===d.type)g.splice(0<=
d.index?d.index:g.length,0,d.element);else if("update"===d.type)for(var k in d.updates)d.updates.hasOwnProperty(k)&&(g[d.index][k]=d.updates[k]);else"delete"===d.type&&g.splice(d.index,1);b(g)})}};
Cable.interval=function(b,a){if(b.substring){var e=[b,"_pid"];a&&(e=e.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(e,function(a,b,e){clearInterval(b());a=setInterval(function(){e(new Date)},a());b(a)})}}return{type:"event",defaultValue:new Date,wireup:function(d){setInterval(function(){d(new Date)},b);a&&d(new Date)}}};Cable.library=function(b,a){return{type:"library",path:b,shim:a}};Cable.module=function(b){return{type:"module",url:b}};
Cable.pack=function(b){var a=function(b){for(var d={},g=1;g<a.argAliases.length;++g)d[a.argAliases[g]]=arguments[g]();b(d)};b=b.slice(0);b.splice(0,0,"result");return Cable.withArgs(b,a)};Cable.counter=function(){return Cable.data(-1,{next:function(){var b=this()+1;this(b);return b}})};Cable.alias=function(b){return{type:"alias",reference:b}};Cable.repeat=function(b,a){return{interval:Cable.interval(b),index:Cable.data(-1),increment:function(b,d){d((d()+1)%a.length)},main:function(b,d){d(a[b()])}}};
Cable.view=function(b,a){var e={},d;for(d in a)if(a.hasOwnProperty(d)){e[d]={};for(var g in a[d])(function(d,g){e[d][g]={request:Cable.withArgs([b,"respond"],function(a,b){a().controller===d&&a().action===g&&b(a())}),main:a[d][g]}})(d,g)}return e};Cable.textbox=function(b){return Cable.withArgs(["$","define"],function(a,e){e(Cable.withArgs(["event"],function(d){var e=a(b),k=function(){return e.is("[type='number']")?parseFloat(e.val()):e.val()};e.on("change keyup",function(){d(k())});d(k())}))})};Cable.checkbox=function(b){return Cable.withArgs(["$","define"],function(a,e){var d=a(b);e(Cable.withArgs(["event"],function(a){d.on("change",function(){a(d.is(":checked"))});a(d.is(":checked"))}))})};
Cable.button=function(b){return Cable.withArgs(["$","define"],function(a,e){e(Cable.withArgs(["event"],function(d){a(b).on("click",function(){d(new Date)})}))})};Cable.returnKey=function(b){return Cable.withArgs(["$","define"],function(a,e){e({type:"event",wireup:function(d){a(b).on("keyup",function(a){13===a.keyCode&&d(new Date)})}})})};
Cable.template=function(b,a){var e=(a.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(a){return a.replace(/\{|\}/g,"")});return{properties:Cable.pack(e),main:Cable.withArgs(["properties","$"],function(d,g){function k(a){return"number"===typeof a?a.toFixed(2):a}for(var r=a,m=0;m<e.length;++m)r=r.replace("{{"+e[m]+"}}",k(d()[e[m]]));g(b).html(r)})}};
Cable.json=function(b){return{url:b,main:Cable.withArgs(["$","url","result"],function(a,b,d){var g=/^http/.test(b())&&!/callback=/.test(b());a.ajax({dataType:"json",url:b(),crossDomain:!!g,success:function(a){d(a)}})})}};Cable.text=function(b){return Cable.withArgs(["$","result"],function(a,e){a.ajax({url:b,dataType:"text",success:function(a){e(a)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(b,a){var e={};b("[cable]").each(function(a,g){b(g).is(":text")?e[g.id]=Cable.textbox("#"+g.id):e[g.id]=Cable.template("#"+g.id,g.innerText)});a(e)})};
Cable.chain=function(b){for(var a=[],e="take drop map filter reduce reduceRight contains max min sortBy groupBy size flatten uniq".split(" "),d=function(b,d){for(var e=d.chain(b()),g=0;g<a.length;++g)e=e[a[g].type].apply(e,a[g].args);return e.value()},g={value:function(){return Cable.withArgs([b,"underscore","result"],function(a,b,e){e(d(a,b))})},each:function(){return Cable.withArgs([b,"underscore","result"],function(a,b,e){d(a,b).forEach(e)})}},k=0;k<e.length;++k)(function(b){g[e[b]]=function(){a.push({type:e[b],
args:arguments});return g}})(k);return g};Cable.hash=function(){return Cable.withArgs(["$","define"],function(b,a){a(Cable.withArgs(["event"],function(a){a(location.hash.replace(/^#/,""));b(window).on("hashchange",function(b){a(location.hash.replace(/^#/,""))})}))})};
Cable.router=function(b){b.substring&&(b=[b]);for(var a=[],e=0;e<b.length;++e)for(var d=b[e].split("/"),g=0;g<d.length;++g)/^:/.test(d[g])&&-1==a.indexOf(d[g].substring(1))&&a.push(d[g].substring(1));e={routeIndex:Cable.data(null),hash:Cable.hash(),main:Cable.data(null),route:Cable.withArgs(["hash","_main","_routeIndex"],function(a,d,e){for(var g=0;g<b.length;++g){var p=b[g].split("/"),s=a().split("/"),q={},t=!1;if(p.length!=s.length)break;for(var n=0;n<p.length;++n)if(/^:/.test(p[n]))q[p[n].substring(1)]=
s[n];else if(p[n]!=s[n]){t=!0;break}if(!t){d(q);e(g);return}}d(!1);e(-1)}),updateTerms:Cable.withArgs(["main"].concat(a.map(function(a){return"_params_"+a})),function(b){var d=a.slice(0),e=b(),g;for(g in e)e.hasOwnProperty(g)&&(arguments[a.indexOf(g)+1](e[g]),d[a.indexOf(g)]=!1);for(e=0;e<d.length;++e)if(d[e])arguments[e+1](null)}),params:{}};for(d=0;d<a.length;++d)e.params[a[d]]=Cable.data(null);return e};
