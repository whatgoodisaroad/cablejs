/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-04-30T22:11:07.856Z              .
.......................................*/
'use strict';var Cable={};"object"===typeof module&&"object"===typeof module.exports&&(Cable._private={},module.exports=Cable);
(function(){function c(a,d){for(var f in a)a.hasOwnProperty(f)&&d(a[f],f)}function b(a){if(a.argAliases)return a.argAliases;a=(a+"").match(/^function(\s*)?\(([^)]*)\)/m)[2];return a.length?a.split(",").map(function(a){return a.replace(/(^\s+)|(\s+$)/g,"")}):[]}function g(a,d){return b(a).filter(function(a){return-1==s.indexOf(a)}).map(function(a){return a.replace(/^_/,"")})}function h(a,d){return b(a).filter(function(a){return-1==s.indexOf(a)&&"_"!=a[0]})}function k(a){var d={};return a&&"[object Function]"===
d.toString.call(a)}function l(a){return-1!=b(a).indexOf("result")||-1!=b(a).indexOf("respond")}function n(a){return-1!==b(a).indexOf("define")}function m(a){a=b(a);return 1===a.length&&"event"===a[0]}function w(a,d){if(d){var f={};c(a,function(a,e){f[e]=d.hasOwnProperty(e)?d[e]:a});return f}return a}function B(a){function d(f){if(f.length){var b=f[0],c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a="("+this.responseText+")";delete e[b];var c={};
try{c[b]=eval(a)}catch(A){throw"Failed to load module '"+b+"': "+A;}Cable.define(c,{reify:!1,wireup:!1});d(f.slice(1))}};c.open("get",e[b].url,!0);c.send()}else a()}var f=[],b;for(b in e)e.hasOwnProperty(b)&&"module"===e[b].type&&f.push(b);d(f)}function x(a,d){for(var f="main"===d?"":"_"+d,e=[],b=0;b<a.length;++b)e.push(a.slice(0,a.length-b).join("_")+f);"main"!==d&&e.push(d);return e}function q(a,d){for(var f=x(d.chain,a),b=0;b<f.length;++b)if(e.hasOwnProperty(f[b]))return"alias"===e[f[b]].type?
(f=e[f[b]],q(f.reference,f.scope)):f[b];return null}function y(){c(e,function(a){a.out=[]});c(e,function(a,d){a.fn&&h(a.fn,a.context).forEach(function(f){var b=q(f,a.scope);if(b)e[b].out.push(d);else throw"Reference to undefined node '"+f+"' as dependency of '"+d+"'";})})}function C(){c(e,function(a,d){if("subdefinition"===a.type)if(D(d))t(d,function(f){f.splice(a.defineIndex,0,function(f){var b={};b[d]=f;Cable.define(b,{scope:a.scope})});delete e[d];a.fn.apply(window,f)});else throw"Illegal subdefinition: "+
d+". Subdefs must depend only on libraries";})}function E(){c(e,function(a,d){if("event"===a.type&&!a.isWiredUp){var f=function(a){p(d,function(d){d(a)})};f.setDefault=function(d){a.value=d};a.wireup(f);a.isWiredUp=!0}})}function p(a,d){if(e.hasOwnProperty(a))F[e[a].type](a,d);else throw"Cannot generate: '"+a+"' is not defined";}function r(a,d,f,b){void 0===f&&(f=[]);a.length?b&&b.hasOwnProperty(a[0])?r(a.slice(1),d,f.concat([b[a[0]]]),b):p(a[0],function(e){r(a.slice(1),d,f.concat([e]),b)}):d(f)}
function t(a,d){var b=e[a]["in"].map(function(d){return q(d,e[a].scope)});r(b,d)}function u(a,d){G[e[a].type](a,d)}function v(a){u(a,function(){})}function D(a){return e[a]["in"].map(function(d){return"library"===e[q(d,e[a].scope)].type}).reduce(function(a,b){return a&&b})}var s=["result","respond","type","event","define"],e={};Cable._debug=function(){return e};Cable.each=c;Cable.define=function(a,d){d=w({reify:!0,wireup:!0,scope:{chain:[]}},d);c(a,function(a,b){if(/^_/.test(b))throw"Illegal definition: names cannot begin with an underscore.";
if(-1!=s.indexOf(b))throw"Illegal definition: "+b+" is a reserved word.";if(e.hasOwnProperty(b))throw"Illegal definition: "+b+" is already defined.";var c=null;a.hasOwnProperty("type")?c=a.type:k(a)?l(a)?c="synthetic":n(a)?c="subdefinition":m(a)?(c="event",a={type:"event",wireup:a}):c="effect":c="scope";if(z.hasOwnProperty(c))z[c](b,a,d.scope);else throw"Illegal definiton: could not determine meaning of "+b;});(d.reify||d.wireup)&&B(function(){d.reify&&(y(),C(),y());d.wireup&&E()})};var z={data:function(a,
d,b){e[a]={type:"data",value:d.value,"in":[],out:[],helpers:d.helpers?d.helpers:{},scope:b}},synthetic:function(a,d,f){-1!=b(d).indexOf("respond")?e[a]={type:"synthetic",fn:d,value:null,invoked:!1,"in":g(d,d.context),out:[],resultIndex:b(d).indexOf("respond"),scope:f,coalesce:!1}:e[a]={type:"synthetic",fn:d,value:null,invoked:!1,"in":g(d,d.context),out:[],resultIndex:b(d).indexOf("result"),scope:f,coalesce:!0}},effect:function(a,d,b){e[a]={type:"effect",fn:d,"in":g(d,d.context),out:[],scope:b}},event:function(a,
d,b){e[a]={type:"event",value:d.defaultValue,wireup:d.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:b}},library:function(a,d,b){e[a]={type:"library",path:d.path,shim:d.shim,handle:null,loaded:!1,scope:b}},scope:function(a,d,b){var e={};c(d,function(b,d){e["main"===d?a:a+"_"+d]=b});d=b.chain.map(function(a){return a+"_"}).join("_");b=b.chain.concat([a.slice(d.length)]);Cable.define(e,{reify:!1,wireup:!1,scope:{chain:b}})},subdefinition:function(a,d,c){e[a]={type:"subdefinition",in:g(d),fn:d,
scope:c,defineIndex:b(d).indexOf("define")}},module:function(a,b,c){e[a]={type:"module",url:b.url,scope:c}},alias:function(a,b,c){e[a]={type:"alias",reference:b.reference,scope:c}}},F={data:function(a,b){var f=function(){if(!arguments.length)return e[a].value;arguments[0]!=e[a].value&&(e[a].value=arguments[0],e[a].out.forEach(v))};c(e[a].helpers,function(a,b){f[b]=function(){return a.apply(f,arguments)}});b(f)},synthetic:function(a,b){e[a].invoked?b(function(){return e[a].value}):u(a,function(){})},
effect:function(){},event:function(a,b){b(function(){if(!arguments.length)return e[a].value;arguments[0]==e[a].value&&e[a].coalesce||(e[a].invoked=!0,e[a].value=arguments[0],e[a].out.forEach(v))})},library:function(a,b){e[a].loaded?b(e[a].handle):u(a,function(){p(a,b)})}},G={data:p.data,event:p.event,synthetic:function(a,b){t(a,function(c){c.splice(e[a].resultIndex,0,function(c){e[a].invoked=!0;e[a].value==c&&e[a].coalesce||(e[a].value=c,e[a].out.forEach(v));b()});e[a].fn.apply({},c)})},effect:function(a,
b){t(a,function(c){e[a].fn.apply({},c);b()})},library:function(a,b){if(e[a].loaded)b();else{var c=function(){var c,f,g={},h=0;arguments[h].substring&&h++;c=arguments[h].splice?arguments[h++]:["require","exports","module"];if(k(arguments[h])){var l=arguments[h];f=-1!==c.indexOf("exports")?function(){var a=l.apply(window,arguments);return void 0!==a?a:g}:l}else{var m=arguments[h];f=function(){return m}}r(c,function(c){e[a].handle=f.apply(window,c);e[a].loaded=!0;b()},[],{require:function(){throw"Cable.js AMD loader does not support CommonJS style require.";
},exports:g,module:null})};c.amd={};var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var b=this.responseText;e[a].shim&&(b=["define(function() {",b,"\nreturn ",e[a].shim,"; });"].join(""));var d=window.define;window.define=c;try{eval(b)}catch(h){throw"Failed evaluating library "+a+": "+h;}window.define=d;"$"===a&&$&&$.noConflict&&$.noConflict()}};g.open("get",e[a].path,!0);g.send()}}};Cable.initialize=function(a,b){"synthetic"===e[a].type&&(e[a].value=
b,e[a].invoked=!0)};Cable._private&&(Cable._private={getArgNames:b,getFanIn:g,getDependencies:h,isSynthetic:l,isSubDefinition:n,isEvent:m,extend:w,enumerateScopes:x})})();Cable.withArgs=function(c,b){b.argAliases=c;return b};Cable.data=function(c,b){var g={type:"data",value:c};b&&(g.helpers=b);return g};Cable.define({init:Cable.withArgs(["event"],function(c){c(new Date)})},{reify:!1,wireup:!1});
Cable.list=function(c){return{array:Cable.data(c),main:Cable.data({type:"initialize",array:c},{insertAt:function(b,c){this({type:"insert",index:b,element:c})},prepend:function(b){this({type:"insert",index:0,element:b})},append:function(b){this({type:"insert",index:-1,element:b})},updateAt:function(b,c){this({type:"update",index:b,updates:c})},deleteAt:function(b){this({type:"delete",index:b})}}),updater:Cable.withArgs(["main","_array"],function(b,c){var h=b(),k=c().slice(0);if("insert"===h.type)k.splice(0<=
h.index?h.index:k.length,0,h.element);else if("update"===h.type)for(var l in h.updates)h.updates.hasOwnProperty(l)&&(k[h.index][l]=h.updates[l]);else"delete"===h.type&&k.splice(h.index,1);c(k)})}};
Cable.interval=function(c,b){if(c.substring){var g=[c,"_pid"];b&&(g=g.concat("init"));return{pid:Cable.data(-1),main:Cable.withArgs(g,function(b,c,g){clearInterval(c());b=setInterval(function(){g(new Date)},b());c(b)})}}return{type:"event",defaultValue:new Date,wireup:function(h){setInterval(function(){h(new Date)},c);b&&h(new Date)}}};Cable.library=function(c,b){return{type:"library",path:c,shim:b}};Cable.module=function(c){return{type:"module",url:c}};
Cable.pack=function(c){var b=function(c){for(var h={},k=1;k<b.argAliases.length;++k)h[b.argAliases[k]]=arguments[k]();c(h)};c=c.slice(0);c.splice(0,0,"result");b.argAliases=c;return b};Cable.counter=function(){return Cable.data(-1,{next:function(){var c=this()+1;this(c);return c}})};Cable.alias=function(c){return{type:"alias",reference:c}};Cable.textbox=function(c){return Cable.withArgs(["$","define"],function(b,g){g(Cable.withArgs(["event"],function(h){var g=b(c),l=function(){return g.is("[type='number']")?parseFloat(g.val()):g.val()};g.on("change keyup",function(){h(l())});h(l())}))})};Cable.checkbox=function(c){return Cable.withArgs(["$","define"],function(b,g){var h=b(c);g(Cable.withArgs(["event"],function(b){h.on("change",function(){b(h.is(":checked"))});b(h.is(":checked"))}))})};
Cable.button=function(c){return Cable.withArgs(["$","define"],function(b,g){g(Cable.withArgs(["event"],function(h){b(c).on("click",function(){h(new Date)})}))})};Cable.returnKey=function(c){return Cable.withArgs(["$","define"],function(b,g){g({type:"event",wireup:function(h){b(c).on("keyup",function(b){13===b.keyCode&&h(new Date)})}})})};
Cable.template=function(c,b){var g=(b.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(b){return b.replace(/\{|\}/g,"")});return{properties:Cable.pack(g),main:Cable.withArgs(["properties","$"],function(h,k){function l(b){return"number"===typeof b?b.toFixed(2):b}for(var n=b,m=0;m<g.length;++m)n=n.replace("{{"+g[m]+"}}",l(h()[g[m]]));k(c).html(n)})}};
Cable.json=function(c){return{url:c,main:Cable.withArgs(["$","url","result"],function(b,c,h){var k=/^http/.test(c())&&!/callback=/.test(c());b.ajax({dataType:"json",url:c(),crossDomain:!!k,success:function(b){h(b)}})})}};Cable.text=function(c){return Cable.withArgs(["$","result"],function(b,g){b.ajax({url:c,dataType:"text",success:function(b){g(b)}})})};
Cable.decorators=function(){return Cable.withArgs(["$","define"],function(c,b){var g={};c("[cable]").each(function(b,k){c(k).is(":text")?g[k.id]=Cable.textbox("#"+k.id):g[k.id]=Cable.template("#"+k.id,k.innerText)});b(g)})};
