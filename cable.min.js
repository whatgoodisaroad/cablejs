/*.......................................
. cablejs: By Wyatt Allen, MIT Licenced .
. 2014-03-18T21:55:22.802Z              .
.......................................*/
var Cable={};
(function(){function b(a,c){for(var g in a)a.hasOwnProperty(g)&&c(a[g],g)}function d(a){return a.argAliases?a.argAliases:(a+"").match(/^function(\s*)?\(([^)]*)\)/m)[2].split(",").map(function(a){return a.replace(/(^\s+)|(\s+$)/g,"")})}function f(a,c){return d(a).filter(function(a){return-1==q.indexOf(a)}).map(function(a){return a.replace(/^_/,"")})}function h(a,c){return d(a).filter(function(a){return-1==q.indexOf(a)&&"_"!=a[0]})}function k(a){var c={};return a&&"[object Function]"===c.toString.call(a)}
function n(a,c){if(c){var g={};b(a,function(a,e){g[e]=c.hasOwnProperty(e)?c[e]:a});return g}return a}function l(a,c){for(var g=c.chain,d="main"===a?"":"_"+a,b=[],f=0;f<g.length;++f)b.push(g.slice(0,g.length-f).join("_")+d);b.push(a);for(g=0;g<b.length;++g)if(e.hasOwnProperty(b[g]))return b[g];return null}function m(){b(e,function(a){a.out=[]});b(e,function(a,c){a.fn&&h(a.fn,a.context).forEach(function(g){var d=l(g,a.scope);if(d)e[d].out.push(c);else throw d=function(a){var c=[];b(a.references,function(a,
g){c.push("'"+g+"' ==> '"+a+"'")});return"named '"+a.name+"' and references {"+c.join(", ")+"}"},"Reference to undefined node '"+g+"' as dependency of '"+c+"'"+(a.hasOwnProperty("context")?" in context "+d(a.context):"");})})}function w(){b(e,function(a,c){"event"!==a.type||a.isWiredUp||(a.wireup(function(a){p(c,function(c){c(a)})}),a.isWiredUp=!0)})}function p(a,c){if(e.hasOwnProperty(a))x[e[a].type](a,c);else throw"Cannot yield: '"+a+"' is not defined";}function t(a,c,g){void 0===g&&(g=[]);a.length?
p(a[0],function(e){t(a.slice(1),c,g.concat([e]))}):c(g)}function u(a,c){var g=e[a]["in"].map(function(c){return l(c,e[a].scope)});t(g,c)}function r(a,c){y[e[a].type](a,c)}function s(a){z(a)&&r(a,function(){})}function z(a){for(var c=e[a]["in"].map(function(c){return l(c,e[a].scope)}),g=0;g<c.length;++g)if("event"===e[c[g]].type&&!e[c[g]].invoked)return!1;return!0}var q=["result","respond","define","type","event"],e={};Cable._debug=function(){return e};Cable.define=function(a,c){c=n({reify:!0,wireup:!0,
scope:{chain:[]}},c);b(a,function(a,b){if(/^_/.test(b))throw"Illegal definition: names cannot begin with an underscore.";if(-1!=q.indexOf(b))throw"Illegal definition: "+b+" is a reserved word.";if(e.hasOwnProperty(b))throw"Illegal definition: "+b+" is already defined.";var f=null,f=a.hasOwnProperty("type")?a.type:k(a)?-1!=d(a).indexOf("result")||-1!=d(a).indexOf("respond")?"synthetic":"effect":"sub";if(v.hasOwnProperty(f))v[f](b,a,c.scope);else if("sub"!==f&&"reference"!==f)throw"Illegal definiton: could not determine meaning of "+
b;});c.reify&&m();c.wireup&&w()};var v={data:function(a,c,b){e[a]={type:"data",value:c.value,"in":[],out:[],helpers:c.helpers?c.helpers:{},scope:b}},synthetic:function(a,c,b){-1!=d(c).indexOf("respond")?e[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":f(c,c.context),out:[],resultIndex:d(c).indexOf("respond"),scope:b,coalesce:!1}:e[a]={type:"synthetic",fn:c,value:null,invoked:!1,"in":f(c,c.context),out:[],resultIndex:d(c).indexOf("result"),scope:b,coalesce:!0}},effect:function(a,c,b){e[a]={type:"effect",
fn:c,"in":f(c,c.context),out:[],scope:b}},event:function(a,c,b){e[a]={type:"event",value:c.defaultValue,wireup:c.wireup,isWiredUp:!1,invoked:!1,"in":[],out:[],scope:b}},library:function(a,c,b){e[a]={type:"library",path:c.path,shim:c.shim,handle:null,loaded:!1,scope:b}},sub:function(a,c,e){var d={};b(c,function(a,c){});b(c,function(c,b){d["main"===b?a:a+"_"+b]=c});Cable.define(d,{reify:!1,wireup:!1,scope:{chain:e.chain.concat([a])}})}},x={data:function(a,c){var d=function(){if(!arguments.length)return e[a].value;
arguments[0]!=e[a].value&&(e[a].value=arguments[0],e[a].out.forEach(s))};b(e[a].helpers,function(a,c){d[c]=function(){return a.apply(d,arguments)}});c(d)},synthetic:function(a,c){e[a].invoked?c(function(){return e[a].value}):r(a,function(){})},effect:function(){},event:function(a,c){c(function(){if(!arguments.length)return e[a].value;arguments[0]==e[a].value&&e[a].coalesce||(e[a].invoked=!0,e[a].value=arguments[0],e[a].out.forEach(s))})},library:function(a,c){e[a].loaded?c(e[a].handle):r(a,function(){p(a,
c)})}};Cable.yield=p;var y={data:p.data,event:p.event,synthetic:function(a,c){u(a,function(b){b.splice(e[a].resultIndex,0,function(b){e[a].invoked=!0;e[a].value==b&&e[a].coalesce||(e[a].value=b,e[a].out.forEach(s));c()});e[a].fn.apply({},b)})},effect:function(a,c){u(a,function(b){e[a].fn.apply({},b);c()})},library:function(a,c){if(e[a].loaded)c();else{var b=function(){var c=arguments.length-1;k(arguments[c])?e[a].handle=arguments[c]():e[a].handle=arguments[c];e[a].loaded=!0};b.amd={};var d=new XMLHttpRequest;
d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var d=this.responseText;e[a].shim&&(d=["define(function() {",d,"\nreturn ",e[a].shim,"; });"].join(""));window.define=b;eval(d);delete window.define;"$"===a&&$&&$.noConflict&&$.noConflict();c()}};d.open("get",e[a].path,!0);d.send()}}};Cable.initialize=function(a,c){"synthetic"===e[a].type&&(e[a].value=c,e[a].invoked=!0)}})();Cable.withArgs=function(b,d){d.argAliases=b;return d};Cable.data=function(b,d){var f={type:"data",value:b};d&&(f.helpers=d);return f};Cable.define({init:{type:"event",wireup:function(b){b(new Date)}}},{reify:!1,wireup:!1});
Cable.list=function(b){return{array:Cable.data(b),main:Cable.data({index:0,howMany:0,replacement:b},{splice:function(b,f,h){this({index:b,howMany:f,replacement:h})},prepend:function(b){this({index:0,howMany:0,replacement:[b]})},append:function(b){this({index:-1,howMany:0,replacement:[b]})},updateAt:function(b,f){this({index:b,howMany:1,replacement:[f]})}}),updater:Cable.withArgs(["main","_array"],function(b,f){var h=b(),k=f().slice(0);0<=h.index?k.splice(h.index,h.howMany,h.replacement):k.splice(k.length-
h.index,h.howMany,h.replacement);f(k)})}};Cable.interval=function(b,d){if(b.substring){var f=["ref","_pid"];d&&(f=f.concat("init"));return{ref:Cable.reference(b),pid:Cable.data(-1),main:Cable.withArgs(f,function(b,d,f){clearInterval(d());b=setInterval(function(){f(new Date)},b());d(b)})}}return{type:"event",defaultValue:new Date,wireup:function(f){setInterval(function(){f(new Date)},b);d&&f(new Date)}}};Cable.library=function(b,d){return{type:"library",path:b,shim:d}};
Cable.pack=function(b){var d=function(b){for(var h={},k=1;k<d.argAliases.length;++k)h[d.argAliases[k]]=arguments[k]();b(h)};b=b.slice(0);b.splice(0,0,"result");d.argAliases=b;return d};Cable.counter=function(){return Cable.data(-1,{next:function(){var b=this()+1;this(b);return b}})};Cable.event=function(b,d,f,h){return{type:"event",coalesce:!1,wireup:function(k){Cable.yield("$",function(n){if("document"===b&&"ready"===d)n(document).ready(k);else{var l=function(){var d=null,h=n(b);f||(f="time");"value"===f?(d=h.val(),h.is("[type='number']")&&(d=parseFloat(d))):"time"===f?d=new Date:/^data-[-_a-zA-Z0-9]+/.test(f)?d=h.attr(f):":checked"===f&&(d=h.is(":checked"));k(d)},m;"key-return"===d?(d="keyup",m=function(b){13===b.keyCode&&l()}):m=l;n(document).on(d,b,m);h&&l()}})}}};
Cable.textbox=function(b){return{type:"event",wireup:function(d){Cable.yield("$",function(f){var h=f(b),k=function(){return h.is("[type='number']")?parseFloat(h.val()):h.val()};h.on("change keyup",function(){d(k())});d(k())})}}};Cable.checkbox=function(b){return Cable.event(b,"change",":checked",!0)};Cable.returnKey=function(b){return{type:"event",wireup:function(d){Cable.yield("$",function(f){f(b).on("keyup",function(b){13===b.keyCode&&d(new Date)})})}}};
Cable.template=function(b,d){var f=(d.match(/\{\{[_a-zA-Z0-9]+\}\}/g)||[]).map(function(b){return b.replace(/\{|\}/g,"")});return{properties:Cable.pack(f),main:Cable.withArgs(["properties","$"],function(h,k){function n(b){return"number"===typeof b?b.toFixed(2):b}for(var l=d,m=0;m<f.length;++m)l=l.replace("{{"+f[m]+"}}",n(h()[f[m]]));k(b).html(l)})}};
Cable.json=function(b){return{url:b,main:Cable.withArgs(["$","url","result"],function(b,f,h){var k=/^http/.test(f())&&!/callback=/.test(f());b.ajax({dataType:"json",url:f(),crossDomain:!!k,success:function(b){h(b)}})})}};Cable.text=function(b){return Cable.withArgs(["$","result"],function(d,f){d.ajax({url:b,dataType:"text",success:function(b){f(b)}})})};
